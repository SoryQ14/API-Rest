<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consumir API</title>
</head>
<body>
    <h1>Usuarios</h1>
    <ul id="users-list"></ul>

    <h2>Buscar Usuario por ID</h2>
    <form id="find-user-form">
        <label for="find-id">ID del usuario:</label>
        <input type="number" id="find-id" name="idusers" required>
        <button type="submit">Buscar Usuario</button>
    </form>
    <p id="user-message"></p>

    <h2>Agregar Usuario</h2>
    <form id="add-user-form">
        <label for="name">Nombre:</label>
        <input type="text" id="name" name="Nombre" required>
        <label for="password">Contraseña:</label>
        <input type="password" id="password" name="Password" required>
        <button type="submit">Agregar Usuario</button>
    </form>

    <h2>Actualizar Usuario</h2>
    <form id="update-user-form">
        <label for="update-id">ID del usuario:</label>
        <input type="number" id="update-id" name="idusers" required>
        <label for="update-name">Nuevo nombre:</label>
        <input type="text" id="update-name" name="Nombre" required>
        <button type="submit">Actualizar Usuario</button>
    </form>

    <h2>Eliminar Usuario</h2>
    <form id="delete-user-form">
        <label for="delete-id">ID del usuario:</label>
        <input type="number" id="delete-id" name="idusers" required>
        <button type="submit">Eliminar Usuario</button>
    </form>

    <script>
         // Función para agregar un usuario
         function addUser(event) {
            event.preventDefault();
            const formData = new FormData(document.getElementById('add-user-form'));
            fetch('http://192.168.0.33:3002/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(Object.fromEntries(formData))
            })
            .then(response => {
                if (response.ok) {
                    getUsers(); // Actualizar la lista de usuarios después de agregar uno nuevo
                } else {
                    throw new Error('Error al agregar usuario');
                }
            })
            .catch(error => console.error('Error al agregar usuario:', error));
        }


        // Función para realizar una petición GET a la API y mostrar los usuarios
        function getUsers() {
            fetch('http://192.168.0.33:3002/users')
            .then(response => response.json())
            .then(users => {
                const usersList = document.getElementById('users-list');
                usersList.innerHTML = ''; // Limpiar la lista antes de actualizarla
                users.forEach(user => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `ID: ${user.idusers}, Nombre: ${user.Nombre}`;
                    usersList.appendChild(listItem);
                });
            })
            .catch(error => console.error('Error al obtener usuarios:', error));
        }


       // Función para actualizar un usuario
    function updateUser(event) {
    event.preventDefault();
    const formData = new FormData(document.getElementById('update-user-form'));
    const id = formData.get('idusers'); // Aquí se utiliza 'idusers' correctamente
    fetch(`http://192.168.0.33:3002/users/${id}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(Object.fromEntries(formData))
    })
    .then(response => {
        if (response.ok) {
            getUsers(); // Actualizar la lista de usuarios después de actualizar uno
        } else {
            throw new Error('Error al actualizar usuario');
        }
    })
    .catch(error => console.error('Error al actualizar usuario:', error));
}



        // Función para eliminar un usuario
        function deleteUser(event) {
            event.preventDefault();
            const formData = new FormData(document.getElementById('delete-user-form'));
            const id = formData.get('idusers');
            fetch(`http://192.168.0.33:3002/users/${id}`, {
                method: 'DELETE'
            })
            .then(response => {
                if (response.ok) {
                    getUsers(); // Actualizar la lista de usuarios después de eliminar uno
                } else {
                    throw new Error('Error al eliminar usuario');
                }
            })
            .catch(error => console.error('Error al eliminar usuario:', error));
        }

        // Función para encontrar un usuario por su ID
    function findUser(event) {
    event.preventDefault();
    const userId = document.getElementById('find-id').value;
    fetch(`http://192.168.0.33:3002/users/${idusers}`)
    .then(response => response.json())
    .then(user => {
        const usersList = document.getElementById('users-list');
        const userMessage = document.getElementById('user-message');
        usersList.innerHTML = ''; // Limpiar la lista antes de actualizarla
        if (user.length > 0) {
            const listItem = document.createElement('li');
            listItem.textContent = `ID: ${users[0].idusers}, Nombre: ${users[0].Nombre}`;
            usersList.appendChild(listItem);
            userMessage.textContent = `Mostrando usuario con ID: ${users[0].idusers} y nombre: ${users[0].Nombre}`;
            // Mostrar un mensaje en el navegador con el nombre y ID del usuario buscado
            alert(`Mostrando usuario con ID: ${users[0].idusers} y nombre: ${users[0].Nombre}`);
        } else {
            usersList.innerHTML = 'Usuario no encontrado';
            userMessage.textContent = '';
            // Mostrar un mensaje en el navegador indicando que el usuario no fue encontrado
            alert('Usuario no encontrado');
        }
    })
    .catch(error => console.error('Error al encontrar usuario:', error));
}



        // Llamar a la función getUsers al cargar la página
        window.onload = function() {
            // Tu código para llamar a getUsers y agregar los event listeners...
            document.getElementById('find-user-form').addEventListener('submit', findUser);
        };

        // Llamar a la función getUsers al cargar la página
        window.onload = function() {
            getUsers();
            document.getElementById('add-user-form').addEventListener('submit', addUser);
            document.getElementById('update-user-form').addEventListener('submit', updateUser);
            document.getElementById('delete-user-form').addEventListener('submit', deleteUser);
        };
        
    </script>
</body>
</html>
